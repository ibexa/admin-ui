{% trans_default_domain 'ibexa_content_forms_content' %}

{% use '@ibexadesign/ui/field_type/edit/binary_base.html.twig' %}

{%- block ezplatform_fieldtype_ibexa_image_row -%}
    {% set preview_block_name = 'ibexa_image_preview' %}
    {% set max_file_size = min(form.parent.vars.value.fieldDefinition.validatorConfiguration.FileSizeValidator.maxFileSize * 1024 * 1024, max_upload_size|round) %}

    {% if mime_types is defined %}
        {% set attr = attr|merge({'data-allowed-file-types': mime_types|join(','), 'accept': mime_types|join(',') }) %}
    {% else %}
        {% set attr = attr|merge({'accept': 'image/*' }) %}
    {% endif %}
    {{ block('binary_base_row') }}
{%- endblock -%}

{% block ibexa_image_preview %}
    {% form_theme form '@ibexadesign/ui/field_type/edit/binary_base_fields.html.twig' %}

    {% set readonly = attr.readonly|default(false) %}

    <div class="ibexa-field-edit-preview">
        <div class="ibexa-field-edit-preview__visual">
            <div class="ibexa-field-edit-preview__media-wrapper">
                <div class="ibexa-field-edit-preview__actions">
                    <twig:ibexa:button
                        html_type="button"
                        type="tertiary-alt"
                        size="small"
                        icon="trash"
                        icon_size="small-medium"
                        :disabled="readonly"
                        class="ibexa-field-edit-preview__action ibexa-field-edit-preview__action--remove"
                    >
                        {{ 'content.field_type.ibexa_image.delete'|trans|desc('Delete') }}
                    </twig:ibexa:button>
                    <twig:ibexa:link
                        href="{{ form.parent.vars.value.value.uri }}"
                        variant="button"
                        type="tertiary-alt"
                        size="small"
                        icon="open-new-window"
                        icon_size="small-medium"
                        target="_blank"
                        class="ibexa-field-edit-preview__action ibexa-field-edit-preview__action--preview"
                    >
                        {{ 'content.field_type.ibexa_image.preview'|trans|desc('Preview') }}
                    </twig:ibexa:link>

                    {% if version_info is defined %}
                        {% set content_id = version_info.contentInfo.id %}
                        {% set version_no = version_info.versionNo %}
                    {% endif %}

                    {{ ibexa_twig_component_group(
                        'admin-ui-image-edit-actions-after',
                        {
                            'fieldDefinitionIdentifier' : form.parent.vars.value.fieldDefinition.identifier,
                            'contentId' : content_id ?? app.request.get('contentId'),
                            'versionNo' : version_no ?? app.request.get('versionNo'),
                            'disabled': readonly ? true : false,
                        }
                    ) }}
                </div>
                <img
                    class="ibexa-field-edit-preview__media"
                    src="{{ form.parent.vars.value.value.uri }}"
                    alt="{{ 'content.field_type.ibexa_image.img_alt'|trans({'%label%': form.vars.label})|desc("Image stored in Field '%label%'") }}"
                />
            </div>
            <div class="ibexa-field-edit-preview__details">
                <div class="ibexa-field-edit-preview__file-name-wrapper">
                    <label class="ibexa-label form-label">{{ 'content.field_type.ibexa_image.file_name.label'|trans|desc('File name') }}</label>
                    <p class="ibexa-field-edit-preview__file-name">{{ form.parent.vars.value.value.fileName }}</p>
                </div>
                <div class="ibexa-field-edit-preview__dimensions-wrapper">
                    <label class="ibexa-label form-label">{{ 'content.field_type.ibexa_image.dimensions.label'|trans|desc('Master dimension') }}</label>
                    <p>
                        <span class="ibexa-field-edit-preview__dimension ibexa-field-edit-preview__dimension--width">
                            {{ 'content.field_type.ibexa_image.dimensions.width'|trans({ '%width%': form.parent.vars.value.value.width})|desc('W:%width% px') }}
                        </span>
                        <span class="ibexa-field-edit-preview__dimension ibexa-field-edit-preview__dimension--height">
                            {{ 'content.field_type.ibexa_image.dimensions.height'|trans({ '%height%': form.parent.vars.value.value.height})|desc('H:%height% px') }}
                        </span>
                    </p>
                </div>
                <div class="ibexa-field-edit-preview__file-size-wrapper">
                    <label class="ibexa-label form-label">{{ 'content.field_type.ibexa_image.file_size.label'|trans|desc('Size') }}</label>
                    <p class="ibexa-field-edit-preview__file-size">{{ form.parent.vars.value.value.fileSize|ibexa_file_size(2) }}</p>
                </div>
            </div>
            <div class="ibexa-field-edit-preview__image-alt">
                {% set alternative_text_label_class = form.vars.is_alternative_text_required ? 'required' : '' %}
                {{ form_row(form.alternativeText, {
                    attr: { 'data-is-required': form.vars.is_alternative_text_required, readonly: readonly },
                    label_attr: { 'class': alternative_text_label_class }
                }) }}
                {{ form_errors(form.alternativeText) }}
            </div>
            {{ form_widget(form.additionalData, {attr: {class: 'ibexa-field-edit-preview__additional-data', readonly: readonly }}) }}
        </div>
    </div>
{% endblock %}
