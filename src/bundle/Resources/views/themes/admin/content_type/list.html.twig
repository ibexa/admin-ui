{% trans_default_domain 'ibexa_content_type' %}

{% from '@ibexadesign/ui/component/macros.html.twig' import results_headline %}

{% form_theme form_content_types_delete '@ibexadesign/ui/form_fields.html.twig'  %}

<section class="container ibexa-container">
    {% set body_rows = [] %}
    {% set show_table_notice = false %}

    {% for content_type in pager.currentPageResults %}
        {% set body_row_cols = [] %}

        {% set col_raw %}
            {% if can_delete %}
                {% if not show_table_notice and not deletable[content_type.id] %}
                    {% set show_table_notice = true %}
                {% endif %}

                {{ form_widget(form_content_types_delete.content_types[content_type.id], {"disabled": not deletable[content_type.id]}) }}
            {% else %}
                {% do form_content_types_delete.content_types.setRendered %}
            {% endif %}
        {% endset %}
        {% set body_row_cols = body_row_cols|merge([{
            has_checkbox: true,
            content: col_raw,
            raw: true,
        }]) %}

        {% set col_raw %}
            <svg class="ibexa-icon ibexa-icon--small-medium">
                <use xlink:href="{{ ibexa_content_type_icon(content_type.identifier) }}"></use>
            </svg>
        {% endset %}
        {% set body_row_cols = body_row_cols|merge([{
            has_icon: true,
            content: col_raw,
            raw: true,
        }]) %}

        {% set col_raw %}
            {% set view_url = path('ibexa.content_type.view', {
                'contentTypeGroupId': content_type_group.id,
                'contentTypeId': content_type.id
            }) %}

            <a href="{{ view_url }}" title="{{ content_type.name }}">{{ content_type.name }}</a>
        {% endset %}
        {% set body_row_cols = body_row_cols|merge([{
            content: col_raw,
            raw: true,
        }]) %}

        {% set body_row_cols = body_row_cols|merge([
            { content: content_type.identifier },
            { content: content_type.id },
            { content: content_type.modificationDate|ibexa_full_datetime },
        ]) %}

        {% set col_raw %}
            {% if can_create %}
                <twig:ibexa:button
                    html_type="button"
                    type="tertiary-alt"
                    icon="copy"
                    icon_size="small"
                    title="{{ 'content_type.action.copy'|trans|desc('Duplicate') }}"
                    class="ids-button--copy-content-type"
                    data-content-type-id="{{ content_type.id }}"
                    data-content-type-identifier="{{ content_type.identifier }}"
                    data-content-type-group-id="{{ content_type_group.id }}"
                />
            {% endif %}
            {% if can_update %}
                <twig:ibexa:link
                    href="{{ path('ibexa.content_type.edit', {'contentTypeGroupId': content_type_group.id, 'contentTypeId': content_type.id}) }}"
                    variant="button"
                    type="tertiary-alt"
                    icon="edit"
                    icon_size="small"
                    title="{{ 'content_type.action.edit'|trans|desc('Edit') }}"
                />
            {% endif %}
        {% endset %}
        {% set body_row_cols = body_row_cols|merge([{
            has_action_btns: true,
            content: col_raw,
            raw: true,
        }]) %}

        {% set body_rows = body_rows|merge([{ cols: body_row_cols }]) %}
    {% endfor %}

    {% embed '@ibexadesign/ui/component/table/table.html.twig' with {
        headline: custom_results_headline ?? results_headline(pager.getNbResults()),
        head_cols: [
            { has_checkbox: true },
            { has_icon: true },
            { content: 'content_type.view.list.column.name'|trans|desc('Name') },
            { content: 'content_type.view.list.column.identifier'|trans|desc('Identifier') },
            { content: 'content_type.view.list.column.id'|trans|desc('ID') },
            { content: 'content_type.view.list.column.modification_date'|trans|desc('Modification date') },
            { },
        ],
        body_rows,
        show_notice: show_table_notice,
        notice_message: 'content_type.view.list.cannot_delete_notice'|trans|desc('You cannot delete the disabled content types, because Content items of those types exist.'),
    } %}
        {% block header %}
            {% embed '@ibexadesign/ui/component/table/table_header.html.twig' %}
                {% block actions %}
                    {% if can_delete %}
                        {% set modal_data_target = 'delete-content-types-modal' %}
                        <twig:ibexa:button
                            id="delete-content-types"
                            html_type="button"
                            type="tertiary-alt"
                            size="small"
                            icon="trash"
                            icon_size="small"
                            :disabled="true"
                            data-bs-toggle="modal"
                            :data-bs-target="'#' ~ modal_data_target"
                        >
                            {{ 'content_type.view.list.action.delete'|trans|desc('Delete') }}
                        </twig:ibexa:button>
                        {% include '@ibexadesign/ui/modal/bulk_delete_confirmation.html.twig' with {
                            'id': modal_data_target,
                            'message': 'content_type.modal.message'|trans|desc('Do you want to delete the content type?'),
                            'data_click': '#content_types_delete_delete',
                        }%}
                    {% endif %}
                {% endblock %}
            {% endembed %}
        {% endblock %}

        {% block between_header_and_table %}
            {{ form_start(form_content_types_delete, {
                'action': path('ibexa.content_type.bulk_delete', {"contentTypeGroupId": group.id} ),
                'attr': { 'class': 'ibexa-toggle-btn-state', 'data-toggle-button-id': '#delete-content-types' }
            }) }}
        {% endblock %}
    {% endembed %}
    {{ form_end(form_content_types_delete) }}

    {{ form_start(content_type_copy_form, { 'attr': {'hidden': 'hidden'}}) }}
    {{ form_end(content_type_copy_form) }}

    {% if pager.haveToPaginate %}
        {% include '@ibexadesign/ui/pagination.html.twig' with {
            'pager': pager,
            'paginaton_params': {
                'routeName': route_name,
                'routeParams': {'contentTypeGroupId': group.id}
            }
        } %}
    {% endif %}
</section>

{% block javascripts %}
    {{ encore_entry_script_tags('ibexa-admin-ui-content-type-list-js', null, 'ibexa') }}
{% endblock %}
